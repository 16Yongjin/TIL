# CPU 성능 측정

## 측정 지표

1. 반응 시간(실행 시간) - 일 처리에 걸린 시간

2. 처리량(대역폭)

단위 시간 당 한 일

## 반응 시간

### Elapsed 시간

- 총 반응 시간 (처리, I/O, OS 오버헤드, Idle 시간 포함)
- 시스템 성능을 나타냄

### CPU 시간

- 특정 작업에 걸린 처리 시간 (I/O, 다른 작업 제외)
- 유저 CPU 시간과 시스템 CPU 시간으로 나뉨

## 상대적인 CPU 성능 정의

성능 == 1 / 실행 시간

A가 B보다 n배 빠르다

```
A 실행 시간 / B 실행 시간 == B 실행 시간 / A 실행 시간 == n
```

A가 10초, B가 15초 걸렸으면:

- A가 B보다 1.5배 빠르다.
- A가 B보다 50% 빠르다.

## CPU 클럭

클럭은 고정

클럭 한 번이 왔다갔다 하는 동안 데이터 전송, 계산, 상태 갱신이 이루어짐

### 클럭 사이클 시간

클럭 사이클 하나가 걸리는 시간

### 클럭 주파수

= 클럭 레이트

초당 사이클, 클럭 사이클 시간의 역수

4GHz면 클럭 사이클은 1/4GHz = 250피코초 = 0.25나노초

## CPU 시간

= CPU 클럭 사이클 \* 클럭 사이클 시간

= CPU 클럭 사이클 / 클럭 레이트

### 성능을 향상을 위해서는

- 클럭 사이클 수를 줄이기
- 클럭 레이트(주파수) 늘리기

### 클럭이 빠르다고 CPU 시간도 줄어드는 게 아님

실행하는 명령어 수(클럭 수)가 많으면 느림

## CPU 시간 예제

컴퓨터 A가 클럭 2GHz, CPU 시간 10초일 때,

컴퓨터 B가 CPU 시간이 6초가 되도록 하기. 다만, 클럭은 빨라져도 클럭 사이클은 1.2배가 됨

컴퓨터 B의 클럭은 얼마나 빨라야 할까?

> CPU 시간 = CPU 클럭 사이클 수 \* 클럭 사이클 시간 = CPU 클럭 사이클 수 / 클럭 레이트

B의 클럭 레이트 = 클럭 사이클 / CPU 시간 = A 클럭 사이클 \* 1.2 / 6초

A 클럭 사이클 = 2GB \* 10

B의 클럭 레이트 = 2GB \* 10 \* 1.2 / 6초 = 2GB \* 10 \* 0.2 = 4GB

## 명령어 수와 CPI

### 프로그램의 명령어 개수

- 프로그램과 ISA, 컴파일러에 결정됨

### 명령어 당 평균 사이클 수

- CPU 하드웨어에 결정됨
- 다른 명령어가 CPI가 다르면 명령어가 섞여서 CPI 평균에 반영됨

### CPI 예제

ISA가 같다 = 명령어 수가 같다 = I

A는 사이클 시간이 250ps, CPI가 2.0
B는 사이클 시간이 500ps, CPI가 1.2

A의 CPU 시간 = I \* 2.0 \* 250ps = I \* 500ps
B의 CPU 시간 = I \* 1.2 \* 500ps = I \* 600ps

= A가 B보다 1.2배 빠름

## CPI 자세히 보기

### 명령어 마다 사이클 수가 다른 경우

클럭 사이클 수 = `zip(CPI 리스트, 명렁어 수 리스트).map(_ * _).sum()`

### 가중치 있는 CPI 평균

CPI = 클럭 사이클 수 / 명령어 수 = `zip(CPI 리스트, 명령어 수 리스트).map(_ * _ / 총 명령어 수).sum()`

### CPI 예제

| 클래스               | A   | B   | C   |
| -------------------- | --- | --- | --- |
| 클래스 당 CPI        | 1   | 2   | 3   |
| 시퀀스 1의 명령어 수 | 2   | 1   | 2   |
| 시퀀스 2의 명령어 수 | 4   | 1   | 1   |

- 시퀀스 1의 명령어 수가 5일 때
  - 클럭 사이클 수 = 2 \* 1 + 1 \* 2 + 2 \* 3 = 10
  - 평균 CPI = 10 / 5 = 2

* 시퀀스 2의 명령어 수가 6일 때

  - 클럭 사이클 수 = 4 \* 1 + 1 \* 2 + 1 \* 3 = 9
  - 평균 CPI = 9 / 6 = 1.5

## CPU 성능 정리

CPU 시간 = 명령어 수 / 프로그램 \* 클럭 사이클 수 / 명령어 \* 걸린 초 / 클럭 사이클

### 성능은 다음에 달림

- 알고리즘 : 명령어 수, CPI
- 프로그래밍 언어 : 명령어 수, CPI
- 컴파일러 : 명령어 수, CPI
- 명령어 셋 아키텍쳐 : 명령어 수, CPI, 클럭 수
- 내부 아키텍처: CPI, 클럭 수

### 개발 환경이 고정된 경우 알고리즘과 프로그램 언어에 집중
