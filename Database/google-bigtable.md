# 구글 빅테이블

## 빅테이블이란?

- 구조화된 데이터를 담는 분산 스토리지 시스템
  - 구조화 되지 않은 데이터: 오디오, 비디오 파일
  - 반만 구조화된 데이터: JSON
  - 구조화 데이터: 엑셀, RDBMS의 데이터
- 페타 바이트의 데이터를 여러 서버에 나눠서 저장할 수 있게 설계됨
  - 분산 == 수평 확장
  - 기존 RDBMS는 수직확장에 용이하지만 수평확장에는 약함
  - 수직확장은 더 좋은 부품을 써야해서 비싸고 한계도 있음
  - 수평확장은 저렴한 서버 여러 개를 사용하면 되므로 효율적임

## 빅테이블의 목표

- 넓은 적용성
  - 한 서비스에 매몰되지 않고 여러 서비스에서도 사용할 수 있음
- 확장성
  - 저렴한 서버 추가로 더 많은 데이터를 저장할 수 있음
- 고성능
  - 다루는 데이터 크기가 커도 ㄱㅊ
- 고가용성
  - 다운타임이 없어야함

## RDBMS와 비슷한 점

- 구조화된 데이터를 저장함
- 테이블 형식으로 데이터를 저장함
- SQL 같은 `Sawzall` 스크립트 언어 제공
  - 하지만 SQL보다 능력이 제한됨

## RDBMS와 차이점

- 인터페이스가 다름
- 스키마가 유동적
- 데이터 레이아웃과 포맷 수정 가능
- 데이터가 Row + Column 이름으로 인덱싱됨
- 인 메모리 저장소 제공
- 스키마 선택으로 데이터의 Locality를 조절할 수 있음
  - Locality: 데이터가 어떻게 나눠져서 보관될 지

## 데이터 모델

- 희소성(Sparse)
  - 테이블의 모든 칼럼 키가 값을 가질 필요 없음
- 분산성
  - 데이터가 타블릿 서버 여러 개에 나눠져 있음
- 영속성
  - 구글 파일 시스템에 저장됨
- 다차원적
- 정렬된 맵
  - Row 키 기반으로 정렬돼서 저장됨

## 데이터 모델 예시

- Row 키, Column 패밀리 키, Column 키, 타임스탬프로 데이터 접근 가능

- 키와 시간에 따라 여러 버전의 데이터가 저장됨 == 다차원적 특성

![image](https://user-images.githubusercontent.com/22253556/94986474-1af07200-059a-11eb-8a07-0ab53302e48c.png)

## Row

- Row 키는 64KB 이하의 랜덤 문자열
- Row 키로 하는 모든 읽기/쓰기는 원자적임
- Row 키의 사전 순서에 따라 테이블이 저장됨
- Row 집합 == Tablet
- Row 키를 잘 선택해야 데이터의 Locality를 활용할 수 있음

## Column 패밀리

- Column 키들을 Column 패밀리들로 묶음
- Column 패밀리가 같은 Column은 타입도 같음
- 그래서 Column 패밀리끼리 압축을 효율적으로 할 수 있음
- Column 키를 저장하기 전에 Column 패밀리를 생성해야함
- 한 테이블에 특정 개수(≈ 100) 이상의 Column 패밀리를 만들 수 없음
- 한 테이블이 가질 수 있는 Column 키는 개수 제한 없음
- ACL(Access Control List)은 Column 패밀리 레벨에서 적용할 수 있음

## 타임스탬프

- 64비트 정수
- 빅테이블은 마이크로초 단위의 실제 시간으로 타임스탬프를 저장함
- 사용자가 임의로 타임스탬프를 설정해서 충돌을 막을 수 있음
- 데이터 버전은 내림차순으로 저장돼서 최근 버전을 가장 처음 읽음
- 버전 개수 제한은 Column 패밀리 레벨에서 설정가능하고 이를 넘으면 가비지 수집됨

## 사용자 API

사용자가 사용할 수 있는 API

- 테이블, Column 패밀리 생성, 삭제
- 클러스터, 테이블, Column 패밀리 메타데이터(ex, ACL) 업데이트
- Row 원자적 변경과 필터링하기
- Row 키 간 트랜잭션은 지원하지 않음
- Join 없음, 테이블이 한 개 뿐이므로.
- Sawzall 스크립트 언어(SQL과 비슷)
- 스크립트 언어는 변형, 필터링, 요약만 지원하고 변경은 지원하지 않음. `grep`과 비슷함

https://youtu.be/CbOH8ixxjdM?t=887
